<!DOCTYPE html>
<html lang="en">
  {% include head.html %}

  <body>
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="wrapper">
        <div class="hero-content">
          <div class="hero-text">
            <h1 class="fade-in">{{ site.resume_name }}</h1>
            <p class="hero-subtitle fade-in">{{ site.resume_title }}</p>
            <div class="hero-intro fade-in">
              {{ site.resume_header_intro }}
            </div>
            <div class="hero-buttons fade-in">
              {% if site.resume_looking_for_work == 'yes' %}
                <a href="mailto:{{ site.resume_contact_email }}" class="btn">Contact Me</a>
              {% endif %}
              <a href="#projects" class="btn btn-outline">View My Projects</a>
            </div>
          </div>
          <div class="hero-image fade-in">
            {% if site.resume_avatar == 'true' %}
              <img src="{{ 'images/avatar.jpg' | relative_url }}" alt="{{ site.resume_name }}" class="avatar">
            {% endif %}
          </div>
        </div>
      </div>
    </section>

    <!-- Projects Section -->
    {% if site.resume_section_projects %}
    <section id="projects" class="section">
      <div class="wrapper">
        <div class="section-header">
          <h2 class="section-title">Projects</h2>
        </div>
        <div class="projects-grid">
          {% for project in site.data.projects %}
          <div class="project-card fade-in" data-project-id="{{ forloop.index }}">
            <div class="project-image-container">
              <div class="project-image-wrapper">
                {% if project.images %}
                  {% for image in project.images %}
                    <img src="{{ image | relative_url }}" alt="{{ project.title }}" class="project-image-slide zoomable-image {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}" data-full-img="{{ image | relative_url }}">
                  {% endfor %}
                  
                  <div class="project-image-controls">
                    <div class="image-control prev" onclick="prevImage({{ forloop.index }})">
                      <i class="fas fa-chevron-left"></i>
                    </div>
                    <div class="image-control next" onclick="nextImage({{ forloop.index }})">
                      <i class="fas fa-chevron-right"></i>
                    </div>
                  </div>
                  
                  <div class="project-overlay">
                    <h3 class="project-title-overlay">{{ project.title }}</h3>
                    <div class="project-gallery-nav">
                      {% for image in project.images %}
                        <div class="gallery-dot {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}" onclick="showImage({{ forloop.index }}, {{ forloop.index0 }})"></div>
                      {% endfor %}
                    </div>
                  </div>
                {% elsif project.image %}
                  <img src="{{ project.image | relative_url }}" alt="{{ project.title }}" class="project-image-slide zoomable-image active" data-full-img="{{ project.image | relative_url }}">
                  <div class="project-overlay">
                    <h3 class="project-title-overlay">{{ project.title }}</h3>
                  </div>
                {% else %}
                  <div class="project-image-slide active" style="background-color: #f5f5f5; display: flex; align-items: center; justify-content: center;">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M14.25 6.75L20.25 12.75L14.25 18.75" stroke="#A0AEC0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M11.25 6.75L17.25 12.75L11.25 18.75" stroke="#A0AEC0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M8.25 6.75L14.25 12.75L8.25 18.75" stroke="#A0AEC0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </div>
                  <div class="project-overlay">
                    <h3 class="project-title-overlay">{{ project.title }}</h3>
                  </div>
                {% endif %}
              </div>
            </div>
            <div class="project-content">
              <h3 class="project-title">
                {% if project.url %}
                  <a href="{{ project.url }}">{{ project.title }}</a>
                {% else %}
                  {{ project.title }}
                {% endif %}
              </h3>
              <div class="project-period">{{ project.period }}</div>
              <p class="project-description">{{ project.description | markdownify }}</p>
              
              {% if project.languages %}
                <div class="badge-section">
                  <div class="badge-title">Technologies:</div>
                  <div class="project-languages">
                    {% for language in project.languages %}
                      <span class="language-badge">{{ language }}</span>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
              
              {% if project.methods %}
                <div class="badge-section">
                  <div class="badge-title">Methods:</div>
                  <div class="project-methods">
                    {% for method in project.methods %}
                      <span class="method-badge">{{ method }}</span>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>
    {% endif %}

    <!-- Skills Section -->
    {% if site.resume_section_skills %}
    <section id="skills" class="section" style="background-color: #f8f9fa;">
      <div class="wrapper">
        <div class="section-header">
          <h2 class="section-title">Skills</h2>
        </div>
        <div class="skills-container">
          {% for skill in site.data.skills %}
          <div class="skill-category fade-in">
            <h3 class="skill-title">{{ skill.skill }}</h3>
            <p>{{ skill.description }}</p>
            
            {% if skill.proficiency %}
            <div class="skill-bar">
              <div class="skill-progress" style="width: 0%" data-value="{{ skill.proficiency }}"></div>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </section>
    {% endif %}

    <!-- Experience Section -->
    {% if site.resume_section_experience %}
    <section id="experience" class="section">
      <div class="wrapper">
        <div class="section-header">
          <h2 class="section-title">Experience</h2>
        </div>
        <div class="timeline">
          {% for job in site.data.experience %}
          <div class="timeline-item fade-in">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
              <h3 class="resume-item-title">{{ job.company }}</h3>
              <h4 class="resume-item-details">{{ job.position }} &bull; {{ job.duration }}</h4>
              <p class="resume-item-copy">{{ job.summary }}</p>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>
    {% endif %}

    <!-- Education Section -->
    {% if site.resume_section_education %}
    <section id="education" class="section" style="background-color: #f8f9fa;">
      <div class="wrapper">
        <div class="section-header">
          <h2 class="section-title">Education</h2>
        </div>
        <div class="education-container">
          {% for education in site.data.education %}
          <div class="education-item fade-in">
            <h3 class="resume-item-title">{{ education.uni }}</h3>
            <h4 class="resume-item-details">{{ education.degree }} &bull; {{ education.year }}</h4>
            {% if education.award %}
              <h5 class="resume-item-details">{{ education.award }}</h5>
            {% endif %}
            
            {% if education.awards %}
              <ul class="resume-item-list">
                {% for award in education.awards %}
                  <li>{{ award.award }}</li>
                {% endfor %}
              </ul>
            {% endif %}
            
            <p class="resume-item-copy">{{ education.summary }}</p>
            
            {% if education.certificates %}
              <h4>Certificates</h4>
              <ul class="resume-item-list">
                {% for certificate in education.certificates %}
                  <li>{{ certificate.certificate }}</li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </section>
    {% endif %}

    <!-- Additional Sections -->
    {% if site.resume_section_recognition %}
    <section id="recognition" class="section">
      <div class="wrapper">
        <div class="section-header">
          <h2 class="section-title">Recognition</h2>
        </div>
        <div class="recognition-container">
          {% for recognition in site.data.recognitions %}
          <div class="recognition-item fade-in">
            <h3 class="resume-item-title">{{ recognition.award }}</h3>
            <h4 class="resume-item-details">{{ recognition.organization }} &bull; {{ recognition.year }}</h4>
            <p class="resume-item-copy">{{ recognition.summary }}</p>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>
    {% endif %}

    {% if site.resume_section_associations %}
    <section id="associations" class="section" style="background-color: #f8f9fa;">
      <div class="wrapper">
        <div class="section-header">
          <h2 class="section-title">Associations</h2>
        </div>
        <div class="associations-container">
          {% for association in site.data.associations %}
          <div class="association-item fade-in">
            <h3 class="resume-item-title">
              {% if association.url %}
                <a href="{{ association.url }}">{{ association.organization }}</a>
              {% else %}
                {{ association.organization }}
              {% endif %}
            </h3>
            <h4 class="resume-item-details">{{ association.role }} &bull; {{ association.year }}</h4>
            <p class="resume-item-copy">{{ association.summary }}</p>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>
    {% endif %}

    {% if site.resume_section_interests %}
    <section id="interests" class="section">
      <div class="wrapper">
        <div class="section-header">
          <h2 class="section-title">Interests</h2>
        </div>
        <div class="interests-container fade-in">
          <ul class="interests-list">
            {% for interest in site.data.interests %}
              <li>{{ interest.description }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </section>
    {% endif %}

    <!-- Contact Section -->
    <section id="contact" class="section" style="background-color: #f8f9fa;">
      <div class="wrapper">
        <div class="section-header">
          <h2 class="section-title">Get In Touch</h2>
        </div>
        <div class="contact-container fade-in">
          <div class="social-links">
            {% if site.resume_social_links.resume_github_url %}
              <a href="{{ site.resume_social_links.resume_github_url }}" class="social-icon" title="GitHub">
                {% include icons/icon-github.html %}
              </a>
            {% endif %}
            
            {% if site.resume_social_links.resume_linkedin_url %}
              <a href="{{ site.resume_social_links.resume_linkedin_url }}" class="social-icon" title="LinkedIn">
                {% include icons/icon-linkedin.html %}
              </a>
            {% endif %}
            
            {% if site.resume_social_links.resume_twitter_url %}
              <a href="{{ site.resume_social_links.resume_twitter_url }}" class="social-icon" title="Twitter">
                {% include icons/icon-twitter.html %}
              </a>
            {% endif %}
            
            {% if site.resume_social_links.resume_website_url %}
              <a href="{{ site.resume_social_links.resume_website_url }}" class="social-icon" title="Website">
                {% include icons/icon-website.html %}
              </a>
            {% endif %}
            
            {% if site.resume_social_links.resume_medium_url %}
              <a href="{{ site.resume_social_links.resume_medium_url }}" class="social-icon" title="Medium">
                {% include icons/icon-medium.html %}
              </a>
            {% endif %}
            
            {% if site.resume_social_links.resume_instagram_url %}
              <a href="{{ site.resume_social_links.resume_instagram_url }}" class="social-icon" title="Instagram">
                {% include icons/icon-instagram.html %}
              </a>
            {% endif %}
            
            {% if site.resume_social_links.resume_facebook_url %}
              <a href="{{ site.resume_social_links.resume_facebook_url }}" class="social-icon" title="Facebook">
                {% include icons/icon-facebook.html %}
              </a>
            {% endif %}
          </div>
          
          {% if site.resume_looking_for_work == 'yes' %}
            <div class="contact-cta">
              <a href="mailto:{{ site.resume_contact_email }}" class="btn">Email Me</a>
            </div>
          {% endif %}
        </div>
      </div>
    </section>

    <!-- Add Image Modal for zoomed view -->
    <div id="imageModal" class="image-modal">
      <div class="modal-container">
        <span class="close-modal">&times;</span>
        <img class="modal-content" id="modalImage">
        <div class="modal-caption" id="modalCaption"></div>
        <div class="modal-navigation">
          <button id="prevImageBtn" class="modal-nav-btn">&lt;</button>
          <button id="nextImageBtn" class="modal-nav-btn">&gt;</button>
        </div>
      </div>
    </div>

    <footer class="page-footer">
      <div class="wrapper">
        <p>&copy; {{ 'now' | date: "%Y" }} {{ site.resume_name }}. All rights reserved.</p>
      </div>
    </footer>

    <!-- JavaScript for animations and interactions -->
    <script>
      // Image slideshow functionality
      let slideshowIntervals = {};
      let currentModalProjectId = null;
      let currentModalImageIndex = 0;
      
      // Initialize slideshows
      function initSlideshows() {
        const projectCards = document.querySelectorAll('.project-card');
        projectCards.forEach(card => {
          const projectId = card.getAttribute('data-project-id');
          const slides = card.querySelectorAll('.project-image-slide');
          
          if (slides.length > 1) {
            // Start automatic slideshow
            startSlideshow(projectId);
            
            // Pause slideshow on hover
            card.addEventListener('mouseenter', () => {
              stopSlideshow(projectId);
            });
            
            // Resume slideshow on mouse leave
            card.addEventListener('mouseleave', () => {
              startSlideshow(projectId);
            });
          }
        });
      }
      
      function startSlideshow(projectId) {
        if (slideshowIntervals[projectId]) {
          clearInterval(slideshowIntervals[projectId]);
        }
        
        slideshowIntervals[projectId] = setInterval(() => {
          nextImage(projectId);
        }, 3000); // Change image every 3 seconds
      }
      
      function stopSlideshow(projectId) {
        if (slideshowIntervals[projectId]) {
          clearInterval(slideshowIntervals[projectId]);
        }
      }
      
      function showImage(projectId, index) {
        const card = document.querySelector(`.project-card[data-project-id="${projectId}"]`);
        if (!card) return;
        
        const slides = card.querySelectorAll('.project-image-slide');
        const dots = card.querySelectorAll('.gallery-dot');
        
        if (slides.length === 0) return;
        
        slides.forEach(slide => {
          slide.classList.remove('active');
        });
        
        dots.forEach(dot => {
          dot.classList.remove('active');
        });
        
        if (slides[index]) {
          slides[index].classList.add('active');
        }
        
        if (dots[index]) {
          dots[index].classList.add('active');
        }
      }
      
      function nextImage(projectId) {
        const card = document.querySelector(`.project-card[data-project-id="${projectId}"]`);
        if (!card) return;
        
        const slides = card.querySelectorAll('.project-image-slide');
        if (slides.length === 0) return;
        
        const currentSlideIndex = Array.from(slides).findIndex(slide => slide.classList.contains('active'));
        const nextIndex = (currentSlideIndex + 1) % slides.length;
        
        showImage(projectId, nextIndex);
      }
      
      function prevImage(projectId) {
        const card = document.querySelector(`.project-card[data-project-id="${projectId}"]`);
        if (!card) return;
        
        const slides = card.querySelectorAll('.project-image-slide');
        if (slides.length === 0) return;
        
        const currentSlideIndex = Array.from(slides).findIndex(slide => slide.classList.contains('active'));
        const prevIndex = (currentSlideIndex - 1 + slides.length) % slides.length;
        
        showImage(projectId, prevIndex);
      }

      // Image Modal functionality
      function setupImageModal() {
        // Get the modal
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImage');
        const captionText = document.getElementById('modalCaption');
        const closeBtn = document.querySelector('.close-modal');
        const prevBtn = document.getElementById('prevImageBtn');
        const nextBtn = document.getElementById('nextImageBtn');
        
        // Get all zoomable images
        const images = document.querySelectorAll('.zoomable-image');
        
        images.forEach(img => {
          img.style.cursor = 'pointer';
          img.addEventListener('click', function(e) {
            e.preventDefault(); // 防止默認行為
            
            const projectCard = this.closest('.project-card');
            if (projectCard) {
              currentModalProjectId = projectCard.getAttribute('data-project-id');
              currentModalImageIndex = parseInt(this.getAttribute('data-index') || 0);
              
              // 顯示模態視窗
              modal.style.display = 'block';
              document.body.style.overflow = 'hidden'; // 防止背景滾動
              
              // 設置圖片和標題
              modalImg.src = this.getAttribute('data-full-img') || this.src;
              captionText.innerHTML = this.alt;
              
              // 載入高解析度圖片
              const highResImg = new Image();
              highResImg.onload = function() {
                modalImg.src = this.src;
              };
              highResImg.src = this.getAttribute('data-full-img') || this.src;
              
              // 檢查是否有多個圖片
              const projectImages = projectCard.querySelectorAll('.project-image-slide');
              if (projectImages.length > 1) {
                prevBtn.style.display = 'block';
                nextBtn.style.display = 'block';
              } else {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
              }
              
              // 停止自動輪播
              stopSlideshow(currentModalProjectId);
            }
          });
        });
        
        // 關閉模態視窗
        closeBtn.addEventListener('click', function() {
          closeModal();
        });
        
        // 點擊背景關閉
        modal.addEventListener('click', function(event) {
          if (event.target === modal) {
            closeModal();
          }
        });
        
        // 在模態視窗中導航
        prevBtn.addEventListener('click', function(e) {
          e.stopPropagation(); // 防止事件冒泡導致關閉模態視窗
          if (currentModalProjectId) {
            navigateModalImage('prev');
          }
        });
        
        nextBtn.addEventListener('click', function(e) {
          e.stopPropagation(); // 防止事件冒泡導致關閉模態視窗
          if (currentModalProjectId) {
            navigateModalImage('next');
          }
        });
        
        // 鍵盤導航
        document.addEventListener('keydown', function(event) {
          if (modal.style.display === 'block') {
            if (event.key === 'Escape') {
              closeModal();
            } else if (event.key === 'ArrowLeft') {
              navigateModalImage('prev');
            } else if (event.key === 'ArrowRight') {
              navigateModalImage('next');
            }
          }
        });
        
        function closeModal() {
          modal.style.display = 'none';
          document.body.style.overflow = ''; // 恢復背景滾動
          
          // 恢復自動輪播
          if (currentModalProjectId) {
            startSlideshow(currentModalProjectId);
            currentModalProjectId = null;
          }
        }
      }
      
      function navigateModalImage(direction) {
        if (!currentModalProjectId) return;
        
        const projectCard = document.querySelector(`.project-card[data-project-id="${currentModalProjectId}"]`);
        if (!projectCard) return;
        
        const images = projectCard.querySelectorAll('.project-image-slide');
        if (images.length <= 1) return;
        
        const modalImg = document.getElementById('modalImage');
        const captionText = document.getElementById('modalCaption');
        
        if (direction === 'next') {
          currentModalImageIndex = (currentModalImageIndex + 1) % images.length;
        } else {
          currentModalImageIndex = (currentModalImageIndex - 1 + images.length) % images.length;
        }
        
        const currentImage = images[currentModalImageIndex];
        // 設置圖片並顯示載入中效果
        modalImg.style.opacity = 0.5;
        
        // 載入高解析度圖片
        const highResImg = new Image();
        highResImg.onload = function() {
          modalImg.src = this.src;
          modalImg.style.opacity = 1;
        };
        highResImg.src = currentImage.getAttribute('data-full-img') || currentImage.src;
        
        captionText.innerHTML = currentImage.alt;
      }

      // Animate skill bars on scroll
      function animateSkillBars() {
        const skillBars = document.querySelectorAll('.skill-progress');
        
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const target = entry.target;
              const value = target.getAttribute('data-value');
              target.style.width = value + '%';
              observer.unobserve(target);
            }
          });
        }, {
          threshold: 0.1
        });
        
        skillBars.forEach(bar => {
          observer.observe(bar);
        });
      }
      
      // Fade-in animation
      function setupFadeAnimations() {
        const fadeElements = document.querySelectorAll('.fade-in');
        
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.style.opacity = 1;
            }
          });
        }, {
          threshold: 0.1
        });
        
        fadeElements.forEach(element => {
          element.style.opacity = 0;
          element.style.transition = 'opacity 0.6s ease-in';
          observer.observe(element);
        });
      }
      
      // Handle image loading errors and optimize images
      function optimizeImages() {
        const images = document.querySelectorAll('.project-image-slide');
        
        images.forEach(img => {
          // Handle loading errors
          img.addEventListener('error', function() {
            this.src = 'data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22286%22%20height%3D%22180%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20286%20180%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_17f59c27b13%20text%20%7B%20fill%3Argba(157%2C157%2C157%2C.75)%3Bfont-weight%3Anormal%3Bfont-family%3AHelvetica%2C%20monospace%3Bfont-size%3A14pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_17f59c27b13%22%3E%3Crect%20width%3D%22286%22%20height%3D%22180%22%20fill%3D%22%23EEEEEE%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%22106.6640625%22%20y%3D%2296.3%22%3ENo%20Image%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E';
          });
          
          // Add loading attribute for better performance
          img.loading = 'lazy';
          
          // Use correct size for thumbnails vs full-size
          if (!img.hasAttribute('data-full-img')) {
            img.setAttribute('data-full-img', img.src);
          }
        });
      }
      
      // Smooth scroll for navigation
      function setupSmoothScroll() {
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth'
              });
            }
          });
        });
      }
      
      // Initialize all functionality when the DOM is ready
      document.addEventListener('DOMContentLoaded', function() {
        initSlideshows();
        setupImageModal();
        animateSkillBars();
        setupFadeAnimations();
        setupSmoothScroll();
        optimizeImages();
      });
    </script>
  </body>
</html>
